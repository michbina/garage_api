<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Devis et Factures - Administration Garage</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/clients.css}">
    <style>
        /* Styles rapides pour les onglets */
        .tabs { display: flex; margin-bottom: 1rem; cursor: pointer; }
        .tab { padding: 10px 20px; border: 1px solid #ccc; border-bottom: none; background: #f5f5f5; }
        .tab.active { background: #fff; font-weight: bold; }
        .tab-content { border: 1px solid #ccc; padding: 1rem; display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
<div class="container">
    <div th:replace="~{admin/menuAdmin :: mainMenuAdmin}"></div>

    <div th:if="${client != null}" class="client-info">
        <h1>Client: <span th:text="${client.username}">nomclient</span></h1>
        <div class="client-details">
            <p><strong>ID Client:</strong> <span th:text="${client.id}">1</span></p>
            <p><strong>Nom d'utilisateur:</strong> <span th:text="${client.username}">nomclient</span></p>
        </div>
    </div>

    <!-- Onglets -->
    <div class="tabs">
        <div class="tab active" data-tab="devis-tab">Devis</div>
        <div class="tab" data-tab="factures-tab">Factures</div>
    </div>

    <!-- Contenu Devis -->
    <div id="devis-tab" class="tab-content active">
        <div th:if="${devis == null || #lists.isEmpty(devis)}" class="alert">
            Ce client n'a aucun devis pour le moment.
        </div>

        <div th:if="${devis != null && !#lists.isEmpty(devis)}">
            <h2>Liste des devis</h2>
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th><th>Description</th><th>Montant</th><th>Date</th><th>Statut</th><th>Actions</th><th>Documents</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="d : ${devis}">
                        <td th:text="${d.id}">1</td>
                        <td th:text="${d.description}">Description devis</td>
                        <td th:text="${d.montant} + ' €'">100.00 €</td>
                        <td th:text="${#temporals.format(d.dateCreation, 'dd/MM/yyyy')}">01/01/2025</td>
                        <td>
                            <span th:if="${d.statut != null && d.statut.name() == 'EN_ATTENTE'}" class="status status-pending">En attente</span>
                            <span th:if="${d.statut != null && d.statut.name() == 'VALIDE'}" class="status status-approved">Validé</span>
                            <span th:if="${d.statut != null && d.statut.name() == 'ANNULE'}" class="status status-cancelled">Annulé</span>
                        </td>
                        <td>
                            <a href="#" class="btn btn-small">Voir détails</a>
                            <a th:if="${d.statut != null && d.statut.name() == 'EN_ATTENTE'}"
                               th:href="@{/admin/devis/{id}/annuler(id=${d.id})}"
                               class="btn btn-small btn-warning"
                               onclick="return confirm('Êtes-vous sûr de vouloir annuler ce devis?')">Annuler</a>
                        </td>
                        <td>
                            <a th:if="${d.documentNom != null}" th:href="@{/devis/{id}/document(id=${d.id})}" class="btn btn-small btn-info">Document</a>
                            <span th:unless="${d.documentNom != null}">Aucun document</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Contenu Factures -->
    <div id="factures-tab" class="tab-content">
        <div th:if="${factures == null || #lists.isEmpty(factures)}" class="alert">
            Ce client n'a aucune facture pour le moment.
        </div>

        <div th:if="${factures != null && !#lists.isEmpty(factures)}">
            <h2>Liste des factures</h2>
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th><th>Description</th><th>Montant</th><th>Date</th><th>Actions</th><th>Documents</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="f : ${factures}">
                        <td th:text="${f.id}">1</td>
                        <td th:text="${f.description}">Description facture</td>
                        <td th:text="${f.montant} + ' €'">100.00 €</td>
                        <td th:text="${#temporals.format(f.dateCreation, 'dd/MM/yyyy')}">01/01/2025</td>
                        <td>
                            <a href="#" class="btn btn-small">Voir détails</a>
                            <a href="#" class="btn btn-small btn-warning">Modifier</a>
                        </td>
                        <td>
                            <a th:if="${f.documentNom != null}" th:href="@{/factures/{id}/document(id=${f.id})}" class="btn btn-small btn-info">Document</a>
                            <span th:unless="${f.documentNom != null}">Aucun document</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="back-button">
        <a th:href="@{/admin}" class="btn btn-secondary">Retour au tableau de bord</a>
    </div>
</div>

<script>
    // Gestion simple des onglets
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById(tab.getAttribute('data-tab')).classList.add('active');
        });
    });
</script>
</body>
</html>
